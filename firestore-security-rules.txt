// ğŸ”’ High School Students Jobs - Secure Firestore Rules
// ì´ ê·œì¹™ì„ Firebase Consoleì—ì„œ ì ìš©í•˜ì„¸ìš”!

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ğŸ” ì‚¬ìš©ì ì¸ì¦ í™•ì¸ í•¨ìˆ˜
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // ğŸ‘‘ ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ í•¨ìˆ˜
    function isAdmin() {
      return isAuthenticated() && 
             request.auth.token.email in [
               'admin@example.com',
               'manager@jobsprout.ca', 
               'admin@jobsprout.ca',
               'nbhighschooljobs@gmail.com'
             ];
    }
    
    // ğŸ‘¤ ë³¸ì¸ ë°ì´í„° í™•ì¸ í•¨ìˆ˜
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }
    
    // ğŸ“– ì‚¬ì´íŠ¸ ì½˜í…ì¸  (ê´€ë¦¬ìë§Œ ì“°ê¸°, ëª¨ë“  ì‚¬ìš©ì ì½ê¸°)
    match /siteContent/{document=**} {
      allow read: if true;  // í™ˆí˜ì´ì§€ ì½˜í…ì¸ ëŠ” ëª¨ë“  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆìŒ
      allow write: if isAdmin();  // ê´€ë¦¬ìë§Œ ìˆ˜ì • ê°€ëŠ¥
    }
    
    // ğŸ¨ ë””ìì¸ ì„¤ì • (ê´€ë¦¬ìë§Œ ì ‘ê·¼)
    match /designSettings/{document=**} {
      allow read: if true;  // ë””ìì¸ì€ ëª¨ë“  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆìŒ
      allow write: if isAdmin();  // ê´€ë¦¬ìë§Œ ìˆ˜ì • ê°€ëŠ¥
    }
    
    // ğŸ‘¥ ì‚¬ìš©ì í”„ë¡œí•„ (ëˆ„êµ¬ë‚˜ ì½ê¸° ê°€ëŠ¥, ë³¸ì¸ë§Œ ìˆ˜ì •)
    match /users/{userId} {
      allow read: if true;  // í•™ìƒ í”„ë¡œí•„ì€ ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆìŒ (êµ¬ì¸ìë“¤ì´ í™•ì¸ìš©)
      allow write: if isOwner(userId) || isAdmin();
    }
    
    // ğŸ’¼ ì±„ìš© ê³µê³  (ëˆ„êµ¬ë‚˜ ì½ê¸° ê°€ëŠ¥, ë“±ë¡ì€ ë¡œê·¸ì¸ í•„ìš”)
    match /jobPostings/{jobId} {
      allow read: if true;  // ëˆ„êµ¬ë‚˜ êµ¬ì¸ê³µê³  ëª©ë¡ ë³¼ ìˆ˜ ìˆìŒ
      allow create: if isAuthenticated();  // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìëŠ” ì±„ìš©ê³µê³  ë“±ë¡ ê°€ëŠ¥
      allow update, delete: if isAdmin();  // ìˆ˜ì •/ì‚­ì œëŠ” ê´€ë¦¬ìë§Œ
    }
    
    // ğŸ“ ì§€ì›ì„œ (ë³¸ì¸ ê²ƒë§Œ ì ‘ê·¼, ê´€ë¦¬ìëŠ” ëª¨ë“  ê²ƒ ì ‘ê·¼)
    match /applications/{applicationId} {
      allow read, write: if isAuthenticated() && 
                         (resource.data.userId == request.auth.uid || isAdmin());
    }
    
    // ğŸ“š ì¶”ì²œì„œ (ë³¸ì¸ ê²ƒë§Œ ì ‘ê·¼, ê´€ë¦¬ìëŠ” ëª¨ë“  ê²ƒ ì ‘ê·¼)
    match /references/{referenceId} {
      allow read, write: if isAuthenticated() && 
                         (resource.data.studentId == request.auth.uid || 
                          resource.data.teacherId == request.auth.uid || 
                          isAdmin());
    }
    
    // ğŸ‰ ì´ë²¤íŠ¸ (ëˆ„êµ¬ë‚˜ ì½ê¸° ê°€ëŠ¥, ê´€ë¦¬ìë§Œ ì“°ê¸°)
    match /events/{eventId} {
      allow read: if true;  // ëˆ„êµ¬ë‚˜ ì´ë²¤íŠ¸ ëª©ë¡ ë³¼ ìˆ˜ ìˆìŒ
      allow write: if isAdmin();  // ì´ë²¤íŠ¸ ë“±ë¡ì€ ê´€ë¦¬ìë§Œ
    }
    
    // ğŸ’¬ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ (ëˆ„êµ¬ë‚˜ ì½ê¸°, ì‘ì„±ì€ ë¡œê·¸ì¸ í•„ìš”)
    match /community/{postId} {
      allow read: if true;  // ëˆ„êµ¬ë‚˜ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ì½ê¸° ê°€ëŠ¥
      allow create: if isAuthenticated();  // ì‘ì„±ì€ ë¡œê·¸ì¸ í•„ìš”
      allow update, delete: if isAuthenticated() && 
                            (resource.data.authorId == request.auth.uid || isAdmin());
    }
    
    // ğŸ“ êµ¬ì§ ì‹ ì²­ (ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼)
    match /jobSeekers/{applicationId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();  // ëˆ„êµ¬ë‚˜ êµ¬ì§ ì‹ ì²­ ê°€ëŠ¥
      allow update, delete: if isAuthenticated() && 
                           (resource.data.email == request.auth.token.email || isAdmin());
    }
    
    // ğŸ“ êµ¬ì¸ê³µê³  ì§€ì› (ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼)
    match /jobApplications/{applicationId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();  // ëˆ„êµ¬ë‚˜ ì§€ì› ê°€ëŠ¥
      allow update, delete: if isAuthenticated() && 
                           (resource.data.applicantId == request.auth.uid || isAdmin());
    }
    
    // ğŸ¤ ë´‰ì‚¬í™œë™ (ëˆ„êµ¬ë‚˜ ì½ê¸° ê°€ëŠ¥, ë“±ë¡ì€ ë¡œê·¸ì¸ í•„ìš”)
    match /volunteerPostings/{postId} {
      allow read: if true;  // ëˆ„êµ¬ë‚˜ ë´‰ì‚¬í™œë™ ëª©ë¡ ë³¼ ìˆ˜ ìˆìŒ
      allow create: if isAuthenticated();  // ë“±ë¡ì€ ë¡œê·¸ì¸ í•„ìš”
      allow update, delete: if isAdmin();
    }
    
    // ğŸ¤ ë´‰ì‚¬í™œë™ ì§€ì›
    match /volunteerApplications/{applicationId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();  // ëˆ„êµ¬ë‚˜ ë´‰ì‚¬í™œë™ ì§€ì› ê°€ëŠ¥
      allow update, delete: if isAuthenticated() && 
                           (resource.data.applicantId == request.auth.uid || isAdmin());
    }
    
    // ğŸ“ íŒŒì¼ ì—…ë¡œë“œ (ì¸ì¦ëœ ì‚¬ìš©ìë§Œ)
    match /uploadedFiles/{fileId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();  // ëˆ„êµ¬ë‚˜ íŒŒì¼ ì—…ë¡œë“œ ê°€ëŠ¥
      allow update, delete: if isAdmin();  // ê´€ë¦¬ë‚˜ë§Œ ìˆ˜ì •/ì‚­ì œ
    }
    
    // ğŸ“ ë¬¸ì˜ì‚¬í•­ (ëˆ„êµ¬ë‚˜ ì œì¶œ ê°€ëŠ¥)
    match /contacts/{contactId} {
      allow read: if isAdmin();  // ê´€ë¦¬ìë§Œ ì½ê¸° (ê°œì¸ì •ë³´ ë³´í˜¸)
      allow create: if true;     // ëˆ„êµ¬ë‚˜ ë¬¸ì˜ ê°€ëŠ¥ (ë¡œê·¸ì¸ ë¶ˆí•„ìš”)
      allow update, delete: if isAdmin();
    }
    
    // ğŸ“‹ ì´ë²¤íŠ¸ ë“±ë¡
    match /eventRegistrations/{registrationId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();  // ëˆ„êµ¬ë‚˜ ì´ë²¤íŠ¸ ë“±ë¡ ê°€ëŠ¥
      allow update, delete: if isAuthenticated() && 
                           (resource.data.userId == request.auth.uid || isAdmin());
    }
    
    // ğŸ“Š í™œë™ ë¡œê·¸ (ê´€ë¦¬ìì™€ ì‹œìŠ¤í…œë§Œ)
    match /logs/{logId} {
      allow read, write: if isAdmin();
    }
    
    // ğŸ¨ ë””ìì¸ ì—ì…‹ (ì—…ë¡œë“œëŠ” ê´€ë¦¬ìë§Œ, ì½ê¸°ëŠ” ëª¨ë“  ì‚¬ìš©ì)
    match /designAssets/{assetId} {
      allow read: if true;  // ë””ìì¸ ì—ì…‹ì€ ëª¨ë“  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆìŒ
      allow write: if isAdmin();  // ì—…ë¡œë“œëŠ” ê´€ë¦¬ìë§Œ
    }
    
    // ğŸ”’ ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ë‹¤ë¥¸ ê²½ë¡œëŠ” ì½ê¸°ë§Œ í—ˆìš© (ìƒˆë¡œìš´ ì»¬ë ‰ì…˜ ëŒ€ë¹„)
    match /{document=**} {
      allow read: if isAuthenticated();
      allow write: if isAdmin();
    }
  }
}

// ğŸ“ Storage ë³´ì•ˆ ê·œì¹™ë„ í•¨ê»˜ ì ìš©í•˜ì„¸ìš”:
// service firebase.storage {
//   match /b/{bucket}/o {
//     match /{allPaths=**} {
//       allow read: if true;  // ì´ë¯¸ì§€ëŠ” ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆìŒ
//       allow write: if request.auth != null;  // ì—…ë¡œë“œëŠ” ì¸ì¦ëœ ì‚¬ìš©ìë§Œ
//     }
//   }
// } 